<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Road to Goal - Nuovo Obiettivo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #ffffff;
            color: #333;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background-color: #f7f7f7;
            border-right: 1px solid #e0e0e0;
            padding-top: 10px;
            display: flex;
            flex-direction: column;
        }
        
        .user-profile {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .user-name {
            font-weight: 600;
            color: #333;
        }
        
        .dropdown-icon {
            color: #777;
            cursor: pointer;
        }
        
        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .menu-item:hover {
            background-color: #f0f0f0;
        }
        
        .menu-item .icon {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .counter {
            margin-left: auto;
            background-color: #f1f1f1;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
            color: #555;
        }
        
        .counter.red {
            background-color: #e74c3c;
            color: white;
        }
        
        .counter.yellow {
            background-color: #f1c40f;
            color: white;
        }
        
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .back-button {
            display: flex;
            align-items: center;
            background: none;
            border: none;
            font-size: 16px;
            color: #555;
            cursor: pointer;
            font-weight: 500;
        }
        
        .back-icon {
            margin-right: 10px;
        }
        
        .page-title {
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: 500;
        }
        
        .form-container {
            max-width: 600px;
            padding: 25px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.2s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .radio-input {
            margin-right: 8px;
            cursor: pointer;
            width: 18px;
            height: 18px;
        }
        
        .number-input {
            width: 100px;
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .btn-container {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border: none;
        }
        
        .btn-cancel {
            background-color: #f1f1f1;
            color: #555;
        }
        
        .btn-cancel:hover {
            background-color: #e0e0e0;
        }
        
        .btn-save {
            background-color: #3498db;
            color: white;
        }
        
        .btn-save:hover {
            background-color: #2980b9;
        }
        
        .form-group.required .form-label:after {
            content: " *";
            color: #e74c3c;
        }
        
        .color-preview {
            display: flex;
            margin-top: 15px;
            gap: 10px;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .color-option.selected {
            border-color: #333;
        }
        
        .color-blue {
            background-color: #3498db;
        }
        
        .color-red {
            background-color: #e74c3c;
        }
        
        .color-green {
            background-color: #2ecc71;
        }
        
        .color-yellow {
            background-color: #f1c40f;
        }
        
        .color-purple {
            background-color: #9b59b6;
        }

        /* Styles for the preview modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            overflow: auto;
        }
        
        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 20px;
            width: 80%;
            max-width: 900px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .close-btn {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 24px;
            cursor: pointer;
        }
        
        .preview-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .btn-proceed {
            background-color: #2ecc71;
            color: white;
            display: block;
            width: 200px;
            margin: 30px auto 10px;
        }
        
        .btn-proceed:hover {
            background-color: #27ae60;
        }

        /* Calendar preview styles */
        .preview-calendar {
            margin-top: 20px;
        }
        
        .calendar-grid-preview {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 15px;
        }
        
        .day-header-preview {
            text-align: center;
            font-weight: 500;
            padding: 8px;
            color: #555;
            font-size: 13px;
        }
        
        .day-preview {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            height: 80px;
            padding: 8px;
            position: relative;
            transition: all 0.2s ease;
            font-size: 0.9em;
        }
        
        .day-number-preview {
            font-weight: 500;
            font-size: 14px;
            position: absolute;
            top: 5px;
            left: 8px;
        }
        
        .day-preview.inactive {
            background-color: #fafafa;
            color: #bbb;
        }
        
        .day-preview.blue {
            background-color: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.3);
        }
        
        .day-preview.red {
            background-color: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        
        .day-preview.green {
            background-color: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .day-preview.yellow {
            background-color: rgba(241, 196, 15, 0.1);
            border: 1px solid rgba(241, 196, 15, 0.3);
        }
        
        .day-preview.purple {
            background-color: rgba(155, 89, 182, 0.1);
            border: 1px solid rgba(155, 89, 182, 0.3);
        }
        
        .day-preview.today {
            border: 2px solid;
        }
        
        .study-time-preview {
            margin-top: 22px;
            font-size: 11px;
            color: #555;
            text-align: center;
        }
        
        .motivational-preview {
            text-align: center;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-style: italic;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            font-weight: bold;
        }
        
        .progress-container-preview {
            margin-bottom: 30px;
        }
        
        .progress-bar-preview {
            background-color: #f1f1f1;
            height: 25px;
            border-radius: 5px;
            margin-bottom: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-preview {
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .progress-text-preview {
            position: absolute;
            width: 100%;
            text-align: center;
            color: white;
            font-weight: bold;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            text-shadow: 0px 0px 2px rgba(0, 0, 0, 0.7);
        }
        
        .progress-info-preview {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        
        .info-item-preview {
            display: flex;
            align-items: center;
            font-size: 13px;
            color: #555;
            margin: 5px 0;
        }
        
        .color-box-preview {
            width: 12px;
            height: 12px;
            margin-right: 5px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="user-profile">
                <span class="user-name">Alessio Franchini</span>
                <span class="dropdown-icon">▼</span>
            </div>
            
            <div class="menu-item">
                <div class="icon">📚</div>
                <span>Libreria</span>
                <span class="counter">1</span>
            </div>
            
            <div class="menu-item">
                <div class="icon">🗂️</div>
                <span>Mazzi Flashcards</span>
                <span class="counter">0</span>
            </div>
            
            <div class="menu-item" style="padding-left: 55px;">
                <div class="icon">📝</div>
                <span>Flashcards da ripassare</span>
                <span class="counter red">0</span>
            </div>
            
            <div class="menu-item" style="padding-left: 55px;">
                <div class="icon">📝</div>
                <span>Flashcards da iniziare</span>
                <span class="counter red">0</span>
            </div>
            
            <div class="menu-item" style="padding-left: 55px;">
                <div class="icon">📝</div>
                <span>Flashcards in attesa</span>
                <span class="counter yellow">0</span>
            </div>
            
            <div class="menu-item active">
                <div class="icon">🎯</div>
                <span>Road to Goal</span>
            </div>
        </div>
        
        <div class="main-content">
            <div class="top-bar">
                <a href="#" class="back-button" id="back-button">
                    <span class="back-icon">←</span>
                    <span>Torna alla dashboard</span>
                </a>
            </div>
            
            <h1 class="page-title">Pianifica un nuovo obiettivo</h1>
            
            <div class="form-container">
                <form id="new-goal-form">
                    <div class="form-group required">
                        <label for="goal-title" class="form-label">Titolo dell'obiettivo</label>
                        <input type="text" id="goal-title" class="form-input" placeholder="Es. Esame di Analisi 1" required>
                    </div>
                    
                    <div class="form-group required">
                        <label for="exam-date" class="form-label">Data dell'esame</label>
                        <input type="date" id="exam-date" class="form-input" required>
                    </div>
                    
                    <div class="form-group required">
                        <label class="form-label">Difficoltà</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="difficulty" value="facile" class="radio-input" required>
                                Facile
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="difficulty" value="medio" class="radio-input" checked>
                                Medio
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="difficulty" value="difficile" class="radio-input">
                                Difficile
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group required">
                        <label for="study-hours" class="form-label">Ore di studio al giorno</label>
                        <input type="number" id="study-hours" class="number-input" min="1" max="12" value="2" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Colore</label>
                        <div class="color-preview">
                            <div class="color-option color-blue selected" data-color="blue"></div>
                            <div class="color-option color-red" data-color="red"></div>
                            <div class="color-option color-green" data-color="green"></div>
                            <div class="color-option color-yellow" data-color="yellow"></div>
                            <div class="color-option color-purple" data-color="purple"></div>
                        </div>
                        <input type="hidden" id="selected-color" value="blue">
                    </div>
                    
                    <div class="form-group">
                        <label for="goal-description" class="form-label">Descrizione (opzionale)</label>
                        <textarea id="goal-description" class="form-input" rows="4" placeholder="Inserisci una breve descrizione del tuo obiettivo..."></textarea>
                    </div>
                    
                    <div class="btn-container">
                        <button type="button" class="btn btn-cancel" id="cancel-btn">Annulla</button>
                        <button type="submit" class="btn btn-save">Salva obiettivo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="preview-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="close-modal">&times;</span>
            <div class="preview-header">
                <h2>Anteprima del tuo piano di studio</h2>
                <p>Ecco come sarà organizzato il calendario in base alle tue scelte</p>
            </div>
            
            <div id="calendar-preview-container">
                <!-- Preview content will be injected here -->
            </div>
            
            <button class="btn btn-proceed" id="confirm-btn">Conferma e procedi</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set minimum date to today
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            document.getElementById('exam-date').setAttribute('min', todayStr);
            
            // Color selection functionality
            const colorOptions = document.querySelectorAll('.color-option');
            const selectedColorInput = document.getElementById('selected-color');
            
            colorOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Remove selected class from all options
                    colorOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    
                    // Update hidden input value
                    selectedColorInput.value = option.dataset.color;
                });
            });
            
            // Get modal elements
            const modal = document.getElementById('preview-modal');
            const closeModal = document.getElementById('close-modal');
            const confirmBtn = document.getElementById('confirm-btn');
            const cancelBtn = document.getElementById('cancel-btn');
            const backBtn = document.getElementById('back-button');
            
            // Store form data globally
            let formData = {};
            
            // Form submission
            document.getElementById('new-goal-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validate required fields are filled
                const title = document.getElementById('goal-title').value;
                const examDate = document.getElementById('exam-date').value;
                const studyHours = document.getElementById('study-hours').value;
                const selectedColor = document.getElementById('selected-color').value;
                const description = document.getElementById('goal-description').value;
                const difficulty = document.querySelector('input[name="difficulty"]:checked').value;
                
                if (!title || !examDate || !studyHours) {
                    alert('Compila tutti i campi obbligatori');
                    return;
                }
                
                // Store form data
                formData = {
                    title: title,
                    examDate: examDate,
                    studyHours: parseInt(studyHours),
                    color: selectedColor,
                    description: description,
                    difficulty: difficulty
                };
                
                // Generate calendar preview
                generateCalendarPreview(formData);
                
                // Show modal
                modal.style.display = 'block';
            });
            
            // Close modal when clicking X
            closeModal.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // Confirm button click
            confirmBtn.addEventListener('click', function() {
                // Save data to localStorage
                localStorage.setItem('goalData', JSON.stringify(formData));
                
                // Redirect to calendar page
                window.location.href = 'calendario_post.html';
            });
            
            // Cancel button click
            cancelBtn.addEventListener('click', function() {
                window.history.back();
            });
            
            // Back button click
            backBtn.addEventListener('click', function(e) {
                e.preventDefault();
                window.history.back();
            });
            
            // Function to generate calendar preview
            function generateCalendarPreview(data) {
                const calendarContainer = document.getElementById('calendar-preview-container');
                const examDate = new Date(data.examDate);
                const currentDate = new Date();
                
                // Calculate days until exam
                const daysUntilExam = Math.floor((examDate - currentDate) / (1000 * 60 * 60 * 24));
                
                // Calculate progress based on difficulty
                let difficultyFactor;
                switch(data.difficulty) {
                    case 'facile':
                        difficultyFactor = 0.8;
                        break;
                    case 'medio':
                        difficultyFactor = 1;
                        break;
                    case 'difficile':
                        difficultyFactor = 1.2;
                        break;
                    default:
                        difficultyFactor = 1;
                }
                
                // Calculate total study hours needed
                const totalStudyHours = Math.ceil(daysUntilExam * data.studyHours * difficultyFactor);
                
                // Generate HTML for calendar preview
                let previewHTML = `
                    <div class="progress-container-preview">
                        <div class="motivational-preview" style="background-color: rgba(${getColorRGB(data.color)}, 0.1); color: rgb(${getColorRGB(data.color)});">
                            ${getMotivationalQuote(data.difficulty)}
                        </div>
                        
                        <div class="progress-bar-preview">
                            <div class="progress-preview" style="width: 0%; background-color: rgb(${getColorRGB(data.color)});"></div>
                            <div class="progress-text-preview">0% Completato</div>
                        </div>
                        
                        <div class="progress-info-preview">
                            <div class="info-item-preview">
                                <div class="color-box-preview" style="background-color: rgb(${getColorRGB(data.color)});"></div>
                                <span>${data.title} (${totalStudyHours} ore totali)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="preview-calendar">
                        <h3>${getMonthName(examDate.getMonth())} ${examDate.getFullYear()}</h3>
                        <div class="calendar-grid-preview" id="calendar-grid-preview">
                `;
                
                // Add day headers
                const weekdays = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
                weekdays.forEach(day => {
                    previewHTML += `<div class="day-header-preview">${day}</div>`;
                });
                
                // Get first day of exam month and total days
                const firstDay = new Date(examDate.getFullYear(), examDate.getMonth(), 1);
                const lastDay = new Date(examDate.getFullYear(), examDate.getMonth() + 1, 0);
                const totalDays = lastDay.getDate();
                
                // Add empty cells for days before first day of month
                for (let i = 0; i < firstDay.getDay(); i++) {
                    previewHTML += `<div class="day-preview inactive"></div>`;
                }
                
                // Add days
                for (let day = 1; day <= totalDays; day++) {
                    const currentDayDate = new Date(examDate.getFullYear(), examDate.getMonth(), day);
                    const isExamDay = currentDayDate.getDate() === examDate.getDate();
                    const isToday = currentDayDate.getDate() === today.getDate() && 
                                   currentDayDate.getMonth() === today.getMonth() && 
                                   currentDayDate.getFullYear() === today.getFullYear();
                    
                    const dayClass = isExamDay ? 
                        `day-preview ${data.color} today` : 
                        (currentDayDate < examDate ? `day-preview ${data.color}` : 'day-preview inactive');
                    
                    const studyTimeText = isExamDay ? 
                        `Esame: ${data.title}` : 
                        (currentDayDate < examDate ? `Studio: ${data.studyHours} ore` : '');
                    
                    previewHTML += `
                        <div class="${dayClass}">
                            <div class="day-number-preview">${day}</div>
                            <div class="study-time-preview">${studyTimeText}</div>
                        </div>
                    `;
                }
                
                previewHTML += `
                        </div>
                    </div>
                `;
                
                // Update calendar container
                calendarContainer.innerHTML = previewHTML;
                
                // Animate progress bar after a short delay
                setTimeout(() => {
                    const progressBar = document.querySelector('.progress-preview');
                    const progressText = document.querySelector('.progress-text-preview');
                    
                    // Calculate progress percentage based on days left and difficulty
                    const progressPercentage = Math.floor(Math.min(100, Math.max(0, 5)));
                    
                    progressBar.style.width = progressPercentage + '%';
                    progressText.textContent = progressPercentage + '% Completato';
                }, 300);
            }
            
            // Helper functions
            function getMonthName(monthIndex) {
                const months = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 
                                'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];
                return months[monthIndex];
            }
            
            function getColorRGB(color) {
                switch(color) {
                    case 'blue': return '52, 152, 219';
                    case 'red': return '231, 76, 60';
                    case 'green': return '46, 204, 113';
                    case 'yellow': return '241, 196, 15';
                    case 'purple': return '155, 89, 182';
                    default: return '52, 152, 219';
                }
            }
            
            function getMotivationalQuote(difficulty) {
                const quotes = {
                    facile: [
                        "Sei sulla strada giusta! Questo obiettivo è alla tua portata.",
                        "Un passo alla volta verso il tuo successo!",
                        "La costanza è la chiave per raggiungere questo obiettivo."
                    ],
                    medio: [
                        "La determinazione supera ogni ostacolo!",
                        "Mantieni il focus e raggiungerai il tuo obiettivo.",
                        "Credi in te stesso e vedrai i risultati!"
                    ],
                    difficile: [
                        "Le sfide più grandi portano alle soddisfazioni migliori!",
                        "Ogni giorno di studio ti avvicina al traguardo.",
                        "Con impegno e dedizione, nessun obiettivo è irraggiungibile!"
                    ]
                };
                
                const quoteArray = quotes[difficulty] || quotes.medio;
                return quoteArray[Math.floor(Math.random() * quoteArray.length)];
            }
        });
    </script>
</body>
</html>